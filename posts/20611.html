<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="使用树莓派作为网关提升nat等级"><link rel="alternate" href="/default" title="Alfyn"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1"><link rel="canonical" href="https://alfyn.me/posts/20611.html"><meta name="description" content="关于nat等级在游玩大部分主机游戏时，一般由于网络没有公网ip，nat类型可能不是nat 2或者nat A，这样便无法游玩通常的联机游戏（或者很困难）。而由于国内运营商一般不会分配公网ip地址，故需要另辟蹊径。方法购买具有公网ip的VPS（虚拟服务器），在其中以tcp_and_udp模式启动sha***ks作为代理。请开放所有端口。1ss-server -p port -k password -m"><meta name="keywords" content="blog"><meta property="og:type" content="article"><meta property="og:title" content="使用树莓派作为网关提升nat等级"><meta property="og:url" content="https://alfyn.me/posts/20611.html"><meta property="og:site_name" content="Alfyn"><meta property="og:description" content="关于nat等级在游玩大部分主机游戏时，一般由于网络没有公网ip，nat类型可能不是nat 2或者nat A，这样便无法游玩通常的联机游戏（或者很困难）。而由于国内运营商一般不会分配公网ip地址，故需要另辟蹊径。方法购买具有公网ip的VPS（虚拟服务器），在其中以tcp_and_udp模式启动sha***ks作为代理。请开放所有端口。1ss-server -p port -k password -m"><meta property="og:locale" content="default"><meta property="og:image" content="https://alfyn.me/posts/20611/nattype.jpg"><meta property="og:updated_time" content="2020-03-26T15:31:09.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="使用树莓派作为网关提升nat等级"><meta name="twitter:description" content="关于nat等级在游玩大部分主机游戏时，一般由于网络没有公网ip，nat类型可能不是nat 2或者nat A，这样便无法游玩通常的联机游戏（或者很困难）。而由于国内运营商一般不会分配公网ip地址，故需要另辟蹊径。方法购买具有公网ip的VPS（虚拟服务器），在其中以tcp_and_udp模式启动sha***ks作为代理。请开放所有端口。1ss-server -p port -k password -m"><meta name="twitter:image" content="https://alfyn.me/posts/20611/nattype.jpg"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1"><link href="https://fonts.rua.im/css?family=Open+Sans" rel="stylesheet"><script type="text/javascript">var themeConfig={fancybox:{enable:!1}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-145372682-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-145372682-1")</script><title>使用树莓派作为网关提升nat等级 - Alfyn</title></head><body><div id="page"><header id="masthead"><div class="site-header-inner"><h1 class="site-title"><a href="/." class="logo">Alfyn</a></h1><nav id="nav-top"><ul id="menu-top" class="nav-top-items"><li class="menu-item"><a href="/about">About</a></li></ul></nav></div></header><div id="content"><div id="primary"><article class="post"><header class="post-header"><h1 class="post-title">使用树莓派作为网关提升nat等级</h1><time class="post-time">Jul 11 2019</time></header><div class="post-content"><h4 id="关于nat等级"><a href="#关于nat等级" class="headerlink" title="关于nat等级"></a>关于nat等级</h4><p>在游玩大部分主机游戏时，一般由于网络没有公网ip，nat类型可能不是nat 2或者nat A，这样便无法游玩通常的联机游戏（或者很困难）。而由于国内运营商一般不会分配公网ip地址，故需要另辟蹊径。</p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ol><li><p>购买具有公网ip的VPS（虚拟服务器），在其中以tcp_and_udp模式启动sha***ks作为代理。请开放所有端口。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss-server -p port -k password -m chacha20-ietf-poly1305 -u</span><br></pre></td></tr></table></figure></li><li><p>将树莓派置于路由器下，例如ip为192.168.1.10。连接上述VPS。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>create a config.json file</span><br><span class="line">&#123;</span><br><span class="line">	"server":"your vps ip",</span><br><span class="line">	"server_port":your vps port,</span><br><span class="line">	"local_address":"0.0.0.0",</span><br><span class="line">	"local_port":8080,</span><br><span class="line">	"password":"password",</span><br><span class="line">	"timeout":300,</span><br><span class="line">	"method":"chacha20-ietf-poly1305",</span><br><span class="line">	"mode":"tcp_and_udp"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ss-redir -c config.json</span><br></pre></td></tr></table></figure></li><li><p>设置iptables用于转发流量。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -d 0/8 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 127/8 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 10/8 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 169.254/16 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 172.16/12 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168/16 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 224/4 -j RETURN</span><br><span class="line">iptables -t nat -A PREROUTING -d 240/4 -j RETURN</span><br><span class="line"> </span><br><span class="line">iptables -t nat -A PREROUTING -p tcp -j REDIRECT --to-ports 8080</span><br><span class="line"></span><br><span class="line">ip rule add fwmark 0x01/0x01 table 100</span><br><span class="line">ip route add local 0.0.0.0/0 dev lo table 100</span><br><span class="line">iptables -t mangle -N SSUDP</span><br><span class="line">iptables -t mangle -A SSUDP -p udp -j TPROXY --on-port 8080 --tproxy-mark 0x01/0x01</span><br><span class="line">iptables -t mangle -A PREROUTING -j SSUDP</span><br><span class="line"></span><br><span class="line">iptables -t mangle -I PREROUTING -d 0/8 -j RETURN</span><br><span class="line">iptables -t mangle -I PREROUTING -d 127/8 -j RETURN  </span><br><span class="line">iptables -t mangle -I PREROUTING -d 10/8 -j RETURN</span><br><span class="line">iptables -t mangle -I PREROUTING -d 169.254/16 -j RETURN</span><br><span class="line">iptables -t mangle -I PREROUTING -d 172.16/12 -j RETURN</span><br><span class="line">iptables -t mangle -I PREROUTING -d 192.168/16 -j RETURN</span><br><span class="line">iptables -t mangle -I PREROUTING -d 224/4 -j RETURN</span><br><span class="line">iptables -t mangle -I PREROUTING -d 240/4 -j RETURN</span><br></pre></td></tr></table></figure></li><li><p>需要上网的设备连上路由器，手动设置网络参数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IP: 192.168.1.x (随意，不与现有设备冲突即可)</span><br><span class="line">NETMASK: 255.255.255.0</span><br><span class="line">GATEWAY: 192.168.1.10 (树莓派ip)</span><br><span class="line">DNS: 192.168.1.10 (树莓派ip)</span><br></pre></td></tr></table></figure></li></ol><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>可见nat已变更为A</p><img src="/posts/20611/nattype.jpg" title="Nat type"></div></article></div></div><footer id="colophon"><span class="copyright-year">&copy; 2019 - 2020 <span class="footer-author">Alfyn.</span> <span class="power-by">Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/henryhuang/hexo-theme-polarbearsimple">Polar Bear Simple</a></span></span></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script><script type="text/javascript" src="/js/src/theme.js?v=1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script></body></html>